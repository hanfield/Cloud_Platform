# 云平台管理系统

一个功能完善的云平台管理系统，支持租户管理、资源管理、合同管理、产品服务管理等功能。

## 项目概述

本系统是一个基于 Django + React 的云平台管理系统，提供管理员和租户两种角色的完整功能支持。

### 主要功能

#### 管理员功能
- **仪表板**: 系统概览、资源统计、运营数据
- **租户管理**: 租户信息管理、资源配额、干系人管理
- **用户管理**: 用户创建、审核、权限管理、密码重置
- **合同管理**: 合同创建、审批、续约管理
- **信息系统管理**: 系统创建、资源分配、运行监控
- **产品管理**: 产品定义、定价策略、库存管理
- **服务管理**: 服务目录、服务订阅、服务监控
- **资产管理**: 物理资产、虚拟资产管理
- **云资源管理**: OpenStack资源管理
- **系统设置**: 系统配置、用户管理

#### 租户功能
- **用户注册**: 租户用户自助注册（需管理员审核）
- **租户门户**: 租户专属自助服务平台
- **基本信息**: 查看租户信息和干系人
- **信息系统概览**: 查看和创建信息系统
- **订单管理**:
  - 虚拟机资源管理（启动/停止）
  - 存储资源查看
  - 网络资源查看
- **产品订阅**: 查看和订阅产品服务
- **数据隔离**: 只能查看和管理本租户的数据

## 技术栈

### 后端
- **框架**: Django 4.2
- **API**: Django REST Framework
- **认证**: JWT (djangorestframework-simplejwt)
- **数据库**: SQLite (开发环境) / PostgreSQL (生产环境)
- **云平台集成**: OpenStack SDK

### 前端
- **框架**: React 18
- **UI组件**: Ant Design 5
- **路由**: React Router 6
- **HTTP客户端**: Axios
- **图表**: Recharts

## 快速开始

### 环境要求

- Python 3.9+
- Node.js 16+
- npm 或 yarn

### 后端安装

\`\`\`bash
# 进入后端目录
cd backend

# 创建虚拟环境
python -m venv .venv

# 激活虚拟环境
# macOS/Linux:
source .venv/bin/activate
# Windows:
.venv\Scripts\activate

# 安装依赖
pip install -r requirements.txt

# 运行数据库迁移
python manage.py migrate

# 初始化默认数据（管理员账号和测试租户）
python init_data.py

# 启动开发服务器
python manage.py runserver
\`\`\`

后端服务将运行在 http://127.0.0.1:8000/

### 前端安装

\`\`\`bash
# 进入前端目录
cd frontend

# 安装依赖
npm install

# 启动开发服务器
npm start
\`\`\`

前端服务将运行在 http://localhost:3000/

## 初始化数据

首次部署时，需要运行初始化脚本创建默认账号：

\`\`\`bash
cd backend
python init_data.py
\`\`\`

该脚本会自动创建：
- 管理员账号（admin/admin123）
- 测试租户（测试租户公司）
- 测试租户用户（tenant/tenant123）

**注意**：如果账号已存在，脚本会跳过创建，不会覆盖现有数据。

详细的安装部署指南请查看 [DEPLOYMENT.md](./DEPLOYMENT.md)

## 用户系统

### 用户类型

系统支持两种用户类型：

1. **管理员用户**
   - 可以管理所有租户和用户
   - 审核用户注册申请
   - 查看所有数据
   - 系统配置权限

2. **租户用户**
   - 需要关联到具体租户
   - 只能查看和管理本租户的数据
   - 可以自助注册（需管理员审核）

### 用户注册流程

1. 访问注册页面 `/register`
2. 填写用户信息并选择所属租户
3. 提交注册申请（状态：待审核）
4. 管理员在用户管理页面审核
5. 审核通过后用户可以登录

### 默认账号

#### 管理员账号
- 用户名: \`admin\`
- 密码: \`admin123\`
- 类型: 管理员

#### 租户测试账号
- 用户名: \`tenant\`
- 密码: \`tenant123\`
- 类型: 租户用户

## 主要API端点

### 认证相关
- \`POST /api/auth/register/\` - 用户注册（公开）
- \`POST /api/auth/login/\` - 用户登录
- \`POST /api/auth/refresh/\` - 刷新Token

### 管理功能
- \`/api/tenants/\` - 租户管理
- \`/api/tenants/users/\` - 用户管理
- \`/api/contracts/\` - 合同管理
- \`/api/information-systems/\` - 信息系统管理
- \`/api/products/\` - 产品管理
- \`/api/services/\` - 服务管理
- \`/api/assets/\` - 资产管理
- \`/api/openstack/\` - OpenStack资源管理

### 租户门户
- \`/api/tenants/portal/\` - 租户门户API

详细API文档请查看 [API.md](./API.md)

## 测试

### 运行后端测试

\`\`\`bash
cd backend
python test_crud.py
\`\`\`

## 权限控制

系统实现了基于用户类型和租户的权限控制：

- **管理员**: 可以访问所有功能和数据
- **租户用户**: 只能访问本租户的数据
- **数据隔离**: 租户用户在查询时自动过滤，只显示本租户数据
- **JWT Token**: Token中包含用户类型和租户ID，用于权限验证

## 更新日志

### v1.1.0
- ✅ 用户管理系统
  - 用户注册功能（租户自助注册）
  - 用户审核流程（待审核/已激活/已拒绝/已暂停）
  - 用户CRUD管理
  - 密码重置功能
- ✅ 用户与租户关联
  - UserProfile模型扩展
  - 用户类型管理（管理员/租户用户）
  - 租户数据隔离
- ✅ 增强的JWT认证
  - Token中包含用户类型和租户信息
  - 登录时验证用户状态
  - 基于角色的权限控制

### v1.0.0
- ✅ 完整的租户管理功能
- ✅ 管理员和租户双角色支持
- ✅ 租户自助服务门户
- ✅ 资源管理和监控
- ✅ 合同和订单管理
- ✅ 产品和服务管理
- ✅ OpenStack集成
- ✅ JWT认证系统
- ✅ 操作日志记录
