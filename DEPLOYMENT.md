# äº‘å¹³å°éƒ¨ç½²æŒ‡å—

æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨å°†äº‘å¹³å°ç®¡ç†ç³»ç»Ÿéƒ¨ç½²åˆ° CentOS 7/8 æˆ–å…¼å®¹çš„ Linux æœåŠ¡å™¨ä¸Šã€‚

## ğŸ“‹ å‡†å¤‡å·¥ä½œ

1. **æœåŠ¡å™¨è¦æ±‚**ï¼š
   - æ“ä½œç³»ç»Ÿï¼šCentOS 7/8, Rocky Linux, AlmaLinux, æˆ– RHEL
   - å†…å­˜ï¼šè‡³å°‘ 4GB (æ¨è 8GB)
   - ç£ç›˜ï¼šè‡³å°‘ 20GB
   - ç½‘ç»œï¼šå¯è®¿é—®äº’è”ç½‘ï¼ˆç”¨äºå®‰è£…ä¾èµ–ï¼‰ï¼Œå¯è®¿é—® OpenStack æ§åˆ¶èŠ‚ç‚¹

2. **è·å–ä»£ç **ï¼š
   ç¡®ä¿æ‚¨å·²ç»å°†æœ€æ–°çš„ä»£ç æ¨é€åˆ° GitHub ä»“åº“ã€‚

## ğŸš€ è‡ªåŠ¨åŒ–éƒ¨ç½²

æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªè‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬ `deploy.sh`ï¼Œå¯ä»¥ä¸€é”®å®Œæˆç¯å¢ƒå®‰è£…ã€æ•°æ®åº“é…ç½®å’Œåº”ç”¨éƒ¨ç½²ã€‚

### æ­¥éª¤ 1: ä¸Šä¼ éƒ¨ç½²è„šæœ¬

å°† `deploy.sh` ä¸Šä¼ åˆ°æ‚¨çš„æœåŠ¡å™¨ï¼ˆä¾‹å¦‚ `/root` æˆ– `/home/user` ç›®å½•ï¼‰ã€‚

```bash
# åœ¨æœ¬åœ°ç»ˆç«¯æ‰§è¡Œ (æ›¿æ¢ä¸ºæ‚¨çš„æœåŠ¡å™¨IP)
scp deploy.sh root@192.168.101.188:/root/
```

### æ­¥éª¤ 2: ç™»å½•æœåŠ¡å™¨

```bash
ssh root@192.168.101.188
```

### æ­¥éª¤ 3: è¿è¡Œéƒ¨ç½²è„šæœ¬

```bash
# èµ‹äºˆæ‰§è¡Œæƒé™
chmod +x deploy.sh

# è¿è¡Œè„šæœ¬ (å»ºè®®ä½¿ç”¨ root ç”¨æˆ·)
./deploy.sh
```

è„šæœ¬å°†è‡ªåŠ¨æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š
1. å®‰è£… Python 3.9, Node.js, PostgreSQL, Redis, Nginx ç­‰ç³»ç»Ÿä¾èµ–
2. é…ç½® PostgreSQL æ•°æ®åº“å’Œç”¨æˆ·
3. å…‹éš†é¡¹ç›®ä»£ç åˆ° `/opt/yunpingtai`
4. åˆ›å»º Python è™šæ‹Ÿç¯å¢ƒå¹¶å®‰è£…åç«¯ä¾èµ–
5. ç¼–è¯‘ React å‰ç«¯ä»£ç 
6. é…ç½® Nginx åå‘ä»£ç†
7. é…ç½®å¹¶å¯åŠ¨ Systemd æœåŠ¡ (Gunicorn, Celery, Nginx)

### æ­¥éª¤ 4: éªŒè¯éƒ¨ç½²

éƒ¨ç½²å®Œæˆåï¼Œæ‰“å¼€æµè§ˆå™¨è®¿é—®æœåŠ¡å™¨ IPï¼š

`http://192.168.101.188`

æ‚¨åº”è¯¥èƒ½çœ‹åˆ°ç™»å½•é¡µé¢ã€‚

## âš™ï¸ åç»­é…ç½®

### 1. ä¿®æ”¹é»˜è®¤å¯†ç 

éƒ¨ç½²è„šæœ¬ä¼šç”Ÿæˆé»˜è®¤çš„æ•°æ®åº“å¯†ç ã€‚ä¸ºäº†å®‰å…¨èµ·è§ï¼Œè¯·ä¿®æ”¹ `.env` æ–‡ä»¶ï¼š

```bash
vim /opt/yunpingtai/backend/.env
```

ä¿®æ”¹å®Œæˆåï¼Œé‡å¯æœåŠ¡ï¼š

```bash
systemctl restart gunicorn celery celerybeat
```

### 2. é…ç½® OpenStack

ç™»å½•ç³»ç»Ÿåï¼Œè¿›å…¥ **ç³»ç»Ÿè®¾ç½® -> OpenStackè®¾ç½®**ï¼Œè¾“å…¥æ‚¨çš„ OpenStack ç¯å¢ƒä¿¡æ¯ï¼š

- **è®¤è¯URL**: `http://<openstack_ip>:5000/v3`
- **ç”¨æˆ·å/å¯†ç **: OpenStack ç®¡ç†å‘˜è´¦å·
- **é¡¹ç›®/åŸŸ**: é€šå¸¸ä¸º `admin` / `Default`

### 3. æŸ¥çœ‹æ—¥å¿—

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œå¯ä»¥æŸ¥çœ‹ä»¥ä¸‹æ—¥å¿—ï¼š

- **åç«¯æ—¥å¿—**: `journalctl -u gunicorn -f`
- **Celeryæ—¥å¿—**: `tail -f /var/log/celery/worker1.log`
- **Nginxæ—¥å¿—**: `/var/log/nginx/error.log`

## ğŸ”„ æ›´æ–°ä»£ç 

å¦‚æœä»£ç æœ‰æ›´æ–°ï¼Œå¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œå‡çº§ï¼š

```bash
cd /opt/yunpingtai
git pull

# å¦‚æœæœ‰åç«¯ä¾èµ–å˜æ›´
cd backend
source venv/bin/activate
pip install -r requirements.txt
python manage.py migrate
systemctl restart gunicorn celery celerybeat

# å¦‚æœæœ‰å‰ç«¯å˜æ›´
cd ../frontend
npm install
npm run build
systemctl restart nginx
```
